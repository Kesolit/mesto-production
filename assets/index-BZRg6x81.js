(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const B=e=>{e.classList.toggle("card__like-button_is-active")},Q=e=>{e.remove()},X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:s})=>{const o=X(),n=o.querySelector(".card__like-button"),c=o.querySelector(".card__control-button_type_delete"),l=o.querySelector(".card__image");return l.src=e.link,l.alt=e.name,o.querySelector(".card__title").textContent=e.name,r&&n.addEventListener("click",()=>r(n)),s&&c.addEventListener("click",()=>s(o)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),o},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&_(e)})},U=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:o})=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r),n.textContent=o,n.classList.add(s)},W=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s})=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r),o.textContent="",o.classList.remove(s)},Z=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s})=>{if(t.validity.valid)W({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s});else if(t.validity.patternMismatch){const o=t.dataset.errorMessage;U({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:o||t.validationMessage})}else U({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:t.validationMessage})},ee=e=>Array.from(e).some(t=>!t.validity.valid),j=({submitButtonElement:e,inactiveButtonClass:t})=>{e.classList.add(t),e.disabled=!0},te=({submitButtonElement:e,inactiveButtonClass:t})=>{e.classList.remove(t),e.disabled=!1},$=({inputList:e,submitButtonElement:t,inactiveButtonClass:r})=>{ee(e)?j({submitButtonElement:t,inactiveButtonClass:r}):te({submitButtonElement:t,inactiveButtonClass:r})},oe=({formElement:e,inputSelector:t,inputErrorClass:r,submitButtonSelector:s,inactiveButtonClass:o,errorClass:n})=>{const c=Array.from(e.querySelectorAll(t)),l=e.querySelector(s);$({inputList:c,submitButtonElement:l,inactiveButtonClass:o}),c.forEach(i=>{i.addEventListener("input",()=>{Z({formElement:e,inputElement:i,inputErrorClass:r,errorClass:n}),$({inputList:c,submitButtonElement:l,inactiveButtonClass:o})})})},g=({formElement:e,submitButtonSelector:t,inactiveButtonClass:r,inputSelector:s,inputErrorClass:o,errorClass:n})=>{const c=Array.from(e.querySelectorAll(s)),l=e.querySelector(t);c.forEach(i=>{W({formElement:e,inputElement:i,inputErrorClass:o,errorClass:n})}),j({submitButtonElement:l,inactiveButtonClass:r})},re=({formSelector:e,inputSelector:t,submitButtonSelector:r,inactiveButtonClass:s,inputErrorClass:o,errorClass:n})=>{Array.from(document.querySelectorAll(e)).forEach(l=>{oe({formElement:l,inputSelector:t,inputErrorClass:o,submitButtonSelector:r,inactiveButtonClass:s,errorClass:n})})},a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2108e16c-7380-45db-b4c3-d26e7a60b633","Content-Type":"application/json"}},f=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ne=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(f),J=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(f),ce=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(f),se=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(f),le=({title:e,imageUrl:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(f),ae=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(f),V=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(f),h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};re(h);const R=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__form"),z=S.querySelector(".popup__input_type_name"),K=S.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),p=E.querySelector(".popup__form"),ie=p.querySelector(".popup__input_type_card-name"),ue=p.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),F=I.querySelector(".popup__image"),de=I.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit-avatar"),y=A.querySelector(".popup__form"),me=y.querySelector(".popup__input"),q=document.querySelector(".popup_type_remove-card"),L=q?.querySelector(".popup__form");let C=null,w=null,T=null;const G=({name:e,link:t})=>{F.src=t,F.alt=e,de.textContent=e,m(I)},fe=e=>{e.preventDefault(),S.querySelector(".popup__button").textContent="Сохранение...",ce({name:z.value,about:K.value}).then(t=>{x.textContent=t.name,P.textContent=t.about,_(k)}).catch(t=>{console.log(t)})},ye=e=>{e.preventDefault(),y.querySelector(".popup__button").textContent="Сохранение...",se(me.value).then(t=>{M.style.backgroundImage=`url(${t.avatar})`,_(A),y.reset()}).catch(t=>{console.log(t)})},he=e=>{e.preventDefault(),p.querySelector(".popup__button").textContent="Создание...",le({name:ie.value,link:ue.value}).then(t=>{const o=N(t,{onPreviewPicture:G,onLikeIcon:c=>{const l=c.classList.contains("card__like-button_is-active"),i=c.closest(".card").querySelector(".card__like-count");V(t._id,l).then(d=>{B(c),i&&(i.textContent=d.likes.length)}).catch(d=>console.log(d))},onDeleteCard:c=>{w=c,T=t._id,m(q)}}),n=o.querySelector(".card__like-count");if(n&&(n.textContent=t.likes.length),t.owner._id!==C){const c=o.querySelector(".card__control-button_type_delete");c&&c.remove()}R.prepend(o),_(E),p.reset(),g({formElement:p,...h})}).catch(t=>{console.log(t)})},Se=e=>{e.preventDefault();const t=L.querySelector(".popup__button");t.textContent="Удаление...",ae(T).then(()=>{Q(w),_(q)}).catch(r=>{console.log(r)})};S.addEventListener("submit",fe);p.addEventListener("submit",he);y.addEventListener("submit",ye);L&&L.addEventListener("submit",Se);pe.addEventListener("click",()=>{z.value=x.textContent,K.value=P.textContent,g({formElement:S,...h}),m(k)});M.addEventListener("click",()=>{y.reset(),g({formElement:y,...h}),m(A)});_e.addEventListener("click",()=>{p.reset(),g({formElement:p,...h}),m(E)});Promise.all([J(),ne()]).then(([e,t])=>{C=t._id,x.textContent=t.name,P.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(r=>{const n=N(r,{onPreviewPicture:G,onLikeIcon:l=>{const i=l.classList.contains("card__like-button_is-active"),d=l.closest(".card").querySelector(".card__like-count");V(r._id,i).then(u=>{B(l),d&&(d.textContent=u.likes.length)}).catch(u=>console.log(u))},onDeleteCard:l=>{w=l,T=r._id,m(q)}}),c=n.querySelector(".card__like-count");if(c&&(c.textContent=r.likes.length),r.owner._id!==C){const l=n.querySelector(".card__control-button_type_delete");l&&l.remove()}R.append(n)})}).catch(e=>{console.log(e)});const ve=document.querySelectorAll(".popup");ve.forEach(e=>{Y(e)});const D=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),ge=()=>{J().then(e=>{const t=document.querySelector(".popup_type_info"),r=t.querySelector(".popup__info"),s=t.querySelector(".popup__list");r.innerHTML="",s.innerHTML="";const o=e.length,n=e[e.length-1],c=e[0],l=new Map;e.forEach(u=>{l.set(u.owner._id,u.owner.name)});const i=(u,v)=>{const b=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return b.querySelector(".popup__info-term").textContent=u,b.querySelector(".popup__info-description").textContent=v,b},d=u=>{const v=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0);return v.querySelector(".popup__list-item").textContent=u,v};r.append(i("Всего карточек:",o)),r.append(i("Первая создана:",D(n.createdAt))),r.append(i("Последняя создана:",D(c.createdAt))),l.forEach(u=>{s.append(d(u))}),m(t)}).catch(e=>console.log(e))},H=document.querySelector(".logo");H&&H.addEventListener("click",ge);
