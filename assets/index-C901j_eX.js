(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const H=e=>{e.classList.toggle("card__like-button_is-active")},G=e=>{e.remove()},Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),B=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:s})=>{const o=Q(),n=o.querySelector(".card__like-button"),c=o.querySelector(".card__control-button_type_delete"),l=o.querySelector(".card__image");return l.src=e.link,l.alt=e.name,o.querySelector(".card__title").textContent=e.name,r&&n.addEventListener("click",()=>r(n)),s&&c.addEventListener("click",()=>s(o)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),o},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&_(e)})},T=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:o})=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r),n.textContent=o,n.classList.add(s)},O=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s})=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r),o.textContent="",o.classList.remove(s)},Y=({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s})=>{if(t.validity.valid)O({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s});else if(t.validity.patternMismatch){const o=t.dataset.errorMessage;T({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:o||t.validationMessage})}else T({formElement:e,inputElement:t,inputErrorClass:r,errorClass:s,errorMessage:t.validationMessage})},Z=e=>Array.from(e).some(t=>!t.validity.valid),W=({submitButtonElement:e,inactiveButtonClass:t})=>{e.classList.add(t),e.disabled=!0},ee=({submitButtonElement:e,inactiveButtonClass:t})=>{e.classList.remove(t),e.disabled=!1},U=({inputList:e,submitButtonElement:t,inactiveButtonClass:r})=>{Z(e)?W({submitButtonElement:t,inactiveButtonClass:r}):ee({submitButtonElement:t,inactiveButtonClass:r})},te=({formElement:e,inputSelector:t,inputErrorClass:r,submitButtonSelector:s,inactiveButtonClass:o,errorClass:n})=>{const c=Array.from(e.querySelectorAll(t)),l=e.querySelector(s);U({inputList:c,submitButtonElement:l,inactiveButtonClass:o}),c.forEach(i=>{i.addEventListener("input",()=>{Y({formElement:e,inputElement:i,inputErrorClass:r,errorClass:n}),U({inputList:c,submitButtonElement:l,inactiveButtonClass:o})})})},v=({formElement:e,submitButtonSelector:t,inactiveButtonClass:r,inputSelector:s,inputErrorClass:o,errorClass:n})=>{const c=Array.from(e.querySelectorAll(s)),l=e.querySelector(t);c.forEach(i=>{O({formElement:e,inputElement:i,inputErrorClass:o,errorClass:n})}),W({submitButtonElement:l,inactiveButtonClass:r})},oe=({formSelector:e,inputSelector:t,submitButtonSelector:r,inactiveButtonClass:s,inputErrorClass:o,errorClass:n})=>{Array.from(document.querySelectorAll(e)).forEach(l=>{te({formElement:l,inputSelector:t,inputErrorClass:o,submitButtonSelector:r,inactiveButtonClass:s,errorClass:n})})},a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2108e16c-7380-45db-b4c3-d26e7a60b633","Content-Type":"application/json"}},f=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),re=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(f),j=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(f),ne=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(f),ce=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(f),se=({title:e,imageUrl:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(f),le=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(f),J=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(f),ae={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(ae);const V=document.querySelector(".places__list"),C=document.querySelector(".popup_type_edit"),h=C.querySelector(".popup__form"),R=h.querySelector(".popup__input_type_name"),z=h.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),p=k.querySelector(".popup__form"),ie=p.querySelector(".popup__input_type_card-name"),ue=p.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),$=E.querySelector(".popup__image"),de=E.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),y=M.querySelector(".popup__form"),me=y.querySelector(".popup__input"),g=document.querySelector(".popup_type_remove-card"),b=g?.querySelector(".popup__form");let L=null,A=null,w=null;const K=({name:e,link:t})=>{$.src=t,$.alt=e,de.textContent=e,m(E)},fe=e=>{e.preventDefault(),h.querySelector(".popup__button").textContent="Сохранение...",ne({name:R.value,about:z.value}).then(t=>{I.textContent=t.name,x.textContent=t.about,_(C)}).catch(t=>{console.log(t)})},ye=e=>{e.preventDefault(),y.querySelector(".popup__button").textContent="Сохранение...",ce(me.value).then(t=>{P.style.backgroundImage=`url(${t.avatar})`,_(M),y.reset()}).catch(t=>{console.log(t)})},he=e=>{e.preventDefault(),p.querySelector(".popup__button").textContent="Создание...",se({name:ie.value,link:ue.value}).then(t=>{const o=B(t,{onPreviewPicture:K,onLikeIcon:c=>{const l=c.classList.contains("card__like-button_is-active"),i=c.closest(".card").querySelector(".card__like-count");J(t._id,l).then(d=>{H(c),i&&(i.textContent=d.likes.length)}).catch(d=>console.log(d))},onDeleteCard:c=>{A=c,w=t._id,m(g)}}),n=o.querySelector(".card__like-count");if(n&&(n.textContent=t.likes.length),t.owner._id!==L){const c=o.querySelector(".card__control-button_type_delete");c&&c.remove()}V.prepend(o),_(k),p.reset(),v(p)}).catch(t=>{console.log(t)})},Se=e=>{e.preventDefault();const t=b.querySelector(".popup__button");t.textContent="Удаление...",le(w).then(()=>{G(A),_(g)}).catch(r=>{console.log(r)})};h.addEventListener("submit",fe);p.addEventListener("submit",he);y.addEventListener("submit",ye);b&&b.addEventListener("submit",Se);pe.addEventListener("click",()=>{R.value=I.textContent,z.value=x.textContent,v(h),m(C)});P.addEventListener("click",()=>{y.reset(),v(y),m(M)});_e.addEventListener("click",()=>{p.reset(),v(p),m(k)});Promise.all([j(),re()]).then(([e,t])=>{L=t._id,I.textContent=t.name,x.textContent=t.about,P.style.backgroundImage=`url(${t.avatar})`,e.forEach(r=>{const n=B(r,{onPreviewPicture:K,onLikeIcon:l=>{const i=l.classList.contains("card__like-button_is-active"),d=l.closest(".card").querySelector(".card__like-count");J(r._id,i).then(u=>{H(l),d&&(d.textContent=u.likes.length)}).catch(u=>console.log(u))},onDeleteCard:l=>{A=l,w=r._id,m(g)}}),c=n.querySelector(".card__like-count");if(c&&(c.textContent=r.likes.length),r.owner._id!==L){const l=n.querySelector(".card__control-button_type_delete");l&&l.remove()}V.append(n)})}).catch(e=>{console.log(e)});const ve=document.querySelectorAll(".popup");ve.forEach(e=>{X(e)});const F=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),ge=()=>{j().then(e=>{const t=document.querySelector(".popup_type_info"),r=t.querySelector(".popup__info"),s=t.querySelector(".popup__list");r.innerHTML="",s.innerHTML="";const o=e.length,n=e[e.length-1],c=e[0],l=new Map;e.forEach(u=>{l.set(u.owner._id,u.owner.name)});const i=(u,S)=>{const q=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return q.querySelector(".popup__info-term").textContent=u,q.querySelector(".popup__info-description").textContent=S,q},d=u=>{const S=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0);return S.querySelector(".popup__list-item").textContent=u,S};r.append(i("Всего карточек:",o)),r.append(i("Первая создана:",F(n.createdAt))),r.append(i("Последняя создана:",F(c.createdAt))),l.forEach(u=>{s.append(d(u))}),m(t)}).catch(e=>console.log(e))},D=document.querySelector(".logo");D&&D.addEventListener("click",ge);
